<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin Panel - MD FX STUDIO</title>
  <style>
    /* --- Base & Theme --- */
    :root{
      --bg:#0b0620;
      --card:#0f0b20;
      --glass: rgba(255,255,255,0.03);
      --accent1: #7c3aed; /* purple */
      --accent2: #ff3cac; /* pink */
      --accent3: #2de0ff; /* blue */
      --text:#e9e7ff;
      --muted:#b9b7d6;
      --shadow: 0 10px 30px rgba(2,2,10,0.6);
    }
    *{box-sizing:border-box;font-family:Inter,system-ui,Arial,sans-serif}
    html,body{height:100%;margin:0;background:
      radial-gradient(1200px 400px at 10% 10%, rgba(124,58,237,0.12), transparent 10%),
      radial-gradient(800px 300px at 90% 80%, rgba(45,224,255,0.06), transparent 8%),
      var(--bg); color:var(--text);
      -webkit-font-smoothing:antialiased;}
    .wrap{max-width:1100px;margin:28px auto;padding:20px;}
    .header{display:flex;gap:16px;align-items:center;justify-content:space-between; flex-wrap: wrap;}
    .brand{display:flex;gap:12px;align-items:center;}
    .logo-preview{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center;box-shadow:var(--shadow);overflow:hidden}
    .logo-preview img{width:100%;height:100%;object-fit:cover}
    h1{font-size:20px;margin:0}
    p.sub{color:var(--muted);margin:0;font-size:13px}
    .panel{display:grid;grid-template-columns:1fr 420px;gap:20px;margin-top:20px}
    @media(max-width:900px){ .panel{grid-template-columns:1fr} }
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:18px;box-shadow:var(--shadow);border:1px solid rgba(255,255,255,0.03)}
    label{display:block;margin:8px 0 6px;color:var(--muted);font-size:13px}
    input[type="text"], input[type="number"], textarea {width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text);outline:none}
    textarea{min-height:90px;resize:vertical}
    .row{display:flex;gap:12px}
    .row .col{flex:1}
    .btn{
      display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:600;
      background: linear-gradient(90deg,var(--accent1),var(--accent2)); color:#fff; box-shadow:0 6px 18px rgba(124,58,237,0.18)
    }
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text);font-weight:600}
    .small{font-size:13px;padding:8px 10px;border-radius:8px}
    .meta{display:flex;gap:10px;align-items:center}
    .file-input{display:flex;gap:8px;align-items:center}
    .plist{margin-top:16px;display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
    .pitem{background:var(--card);padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,0.02);transition:transform .18s ease, box-shadow .18s;overflow:hidden}
    .pitem:hover{transform:translateY(-6px);box-shadow:0 18px 30px rgba(2,2,10,0.5)}
    .pthumb{height:120px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));display:flex;align-items:center;justify-content:center;overflow:hidden}
    .pthumb img{width:100%;height:100%;object-fit:cover}
    .ptitle{font-weight:700;margin:8px 0 4px}
    .price{color:var(--accent3);font-weight:700}
    .offer{color:var(--accent2);font-weight:700;font-size:13px}
    .actions{display:flex;gap:8px;margin-top:8px}
    .settings{display:flex;flex-direction:column;gap:12px}
    .logo-drop{height:140px;border-radius:12px;display:flex;align-items:center;justify-content:center;border:1px dashed rgba(255,255,255,0.03);background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02))}
    .note{font-size:13px;color:var(--muted)}
    footer{margin-top:20px;color:var(--muted);font-size:13px;text-align:center}
    .hint{font-size:12px;color:var(--muted);margin-top:8px}
    .flex-between{display:flex;justify-content:space-between;align-items:center;gap:8px}
    .danger{background:linear-gradient(90deg,#ff5c7c,#ff6f9c);color:white}
    .mutebtn{background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));color:var(--muted)}
    .orders-btn{
      background: linear-gradient(90deg, var(--accent3), var(--accent1));
      color: #fff;
      text-decoration: none;
      padding: 10px 14px;
      border-radius: 10px;
      font-weight: 600;
      box-shadow: 0 6px 18px rgba(45, 224, 255, 0.18);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="brand">
        <div class="logo-preview" id="logoPreview">
          <img id="logoImg" src="" alt="Logo" style="display:none">
          <svg id="logoSvg" width="34" height="34" viewBox="0 0 24 24" fill="none" style="opacity:0.7">
            <rect width="24" height="24" rx="6" fill="url(#g)"></rect>
            <defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#7c3aed"/><stop offset="1" stop-color="#ff3cac"/></linearGradient></defs>
          </svg>
        </div>
        <div>
          <h1>MD FX STUDIO Admin</h1>
          <p class="sub" id="adminStatus">Please Login to manage data.</p>
        </div>
      </div>
      <div class="meta">
        <a class="orders-btn" href="Oder.html" target="_blank">Show Orders →</a>
        <a class="btn" href="store.html" target="_blank">Open Store →</a>
      </div>
    </div>

    <!-- Login/Logout Area -->
    <div class="card" style="margin-top:20px;">
        <h3 style="margin:0">Admin Access</h3>
        <p id="authMessage" style="color:var(--muted);font-size:14px;margin-top:8px;">You must be logged in to modify products and settings.</p>
        <button class="btn" id="loginBtn" style="margin-top:12px;">Login with Google</button>
        <button class="btn danger" id="logoutBtn" style="margin-top:12px;display:none;">Logout</button>
    </div>

    <!-- Main Panel (Hidden until logged in) -->
    <div id="mainPanelContent" style="display:none;">
        <div class="panel">
            <!-- LEFT: Product Management -->
            <div>
                <div class="card">
                    <h3 style="margin:0 0 8px">Add / Edit Product</h3>
                    <div class="hint">Use image URLs. Data saves instantly to Firebase.</div>
                    <input type="hidden" id="editDocId" value="">
                    <label>Product Title</label>
                    <input id="pTitle" type="text" placeholder="Example: Cinematic LUT Pack">
                    <label>Description</label>
                    <textarea id="pDesc" placeholder="Short description for the product"></textarea>
                    <div class="row" style="margin-top:8px">
                        <div class="col">
                            <label>Price (INR)</label>
                            <input id="pPrice" type="number" placeholder="199">
                        </div>
                        <div class="col">
                            <label>Offer (optional)</label>
                            <input id="pOffer" type="text" placeholder="20% off or ₹50 off">
                        </div>
                    </div>
                    <label style="margin-top:10px">Razorpay Payment Link</label>
                    <input id="pRazor" type="text" placeholder="https://rzp.io/..... (paste your Razorpay payment link)">
                    <label style="margin-top:10px">Product Image URL</label>
                    <div class="file-input">
                        <input id="pImage" type="text" placeholder="Paste image URL">
                    </div>
                    <div style="display:flex;gap:8px;margin-top:12px;align-items:center">
                        <button class="btn" id="saveBtn">Save Product</button>
                        <button class="btn ghost" id="resetForm">Reset</button>
                    </div>
                </div>
                <div class="card" style="margin-top:14px">
                    <div style="display:flex;justify-content:space-between;align-items:center">
                        <h3 style="margin:0">Products</h3>
                        <div class="note">Products saved in your Firebase Firestore</div>
                    </div>
                    <div class="plist" id="productList"></div>
                </div>
            </div>
            <!-- RIGHT: Store Settings -->
            <div>
                <div class="card settings">
                    <h3 style="margin:0">Store Settings</h3>
                    <label>Store Name</label>
                    <input id="storeName" placeholder="Example: MdProFX Store">
                    <label>Store Logo URL</label>
                    <input id="logoInput" type="text" placeholder="Paste logo URL">
                    <div style="display:flex;gap:8px;margin-top:8px">
                        <button class="btn" id="saveSettingsBtn">Save Settings</button>
                    </div>
                </div>
                <div class="card" style="margin-top:12px">
                    <h3 style="margin:0">How to use</h3>
                    <ol style="color:var(--muted);padding-left:18px">
                        <li>Store name & logo set karein.</li>
                        <li>Naya product add karein — image URL paste karein.</li>
                        <li>Razorpay link paste karein (Buy Now button open karega).</li>
                        <li>Store page <strong>user.html</strong> open karke check karein.</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
    <footer>Made with ❤️ • Purple • Pink • Blue theme • Firebase</footer>
  </div>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
    import { getFirestore, collection, addDoc, doc, setDoc, getDoc, onSnapshot, deleteDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
    
    // Your web app's Firebase configuration (New Config with AppID 5641abc073eabfc06219ac)
    const firebaseConfig = {
      apiKey: "AIzaSyCrtplmwrLhu39KNbDGLmETk0gB2R9aJh0",
      authDomain: "md-fx-studio.firebaseapp.com",
      projectId: "md-fx-studio",
      storageBucket: "md-fx-studio.firebasestorage.app",
      messagingSenderId: "376817060805",
      appId: "1:376817060805:web:5641abc073eabfc06219ac"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    const __app_id = "md-fx-studio";
    
    // DOM elements
    const productList = document.getElementById('productList');
    const pTitle = document.getElementById('pTitle');
    const pDesc = document.getElementById('pDesc');
    const pPrice = document.getElementById('pPrice');
    const pOffer = document.getElementById('pOffer');
    const pRazor = document.getElementById('pRazor');
    const pImage = document.getElementById('pImage');
    const editDocId = document.getElementById('editDocId');
    const saveBtn = document.getElementById('saveBtn');
    const resetFormBtn = document.getElementById('resetForm');
    const storeNameInput = document.getElementById('storeName');
    const logoInput = document.getElementById('logoInput');
    const saveSettingsBtn = document.getElementById('saveSettingsBtn');
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const mainPanelContent = document.getElementById('mainPanelContent');
    const authMessage = document.getElementById('authMessage');
    const adminStatus = document.getElementById('adminStatus');

    let currentUser = null;
    
    onAuthStateChanged(auth, (user) => {
        currentUser = user;
        if (currentUser) {
            loginBtn.style.display = 'none';
            logoutBtn.style.display = 'block';
            mainPanelContent.style.display = 'block';
            authMessage.style.display = 'none';
            adminStatus.textContent = `Logged in as: ${currentUser.email}`;
            setupRealtimeListeners();
            loadStoreSettings();
        } else {
            loginBtn.style.display = 'block';
            logoutBtn.style.display = 'none';
            mainPanelContent.style.display = 'none';
            authMessage.style.display = 'block';
            adminStatus.textContent = 'Please Login to manage data.';
            productList.innerHTML = '<div class="note" style="text-align:center;">Login to manage products.</div>';
        }
    });

    loginBtn.addEventListener('click', async () => {
        try {
            await signInWithPopup(auth, provider);
        } catch (error) {
            console.error("Login failed:", error);
            alert("Login failed: " + error.message);
        }
    });

    logoutBtn.addEventListener('click', async () => {
        await signOut(auth);
    });
    
    async function loadStoreSettings() {
        if (!currentUser) return;
        const storeDocRef = doc(db, 'artifacts', __app_id, 'users', currentUser.uid, 'settings', 'store');
        const storeDoc = await getDoc(storeDocRef);
        if (storeDoc.exists()) {
            const settings = storeDoc.data();
            storeNameInput.value = settings.name || '';
            logoInput.value = settings.logo || '';
            document.getElementById('logoImg').src = settings.logo || '';
            document.getElementById('logoImg').style.display = settings.logo ? 'block' : 'none';
            document.getElementById('logoSvg').style.display = settings.logo ? 'none' : 'block';
        } else {
            document.getElementById('logoImg').style.display = 'none';
            document.getElementById('logoSvg').style.display = 'block';
        }
    }
    
    saveSettingsBtn.addEventListener('click', async () => {
        if (!currentUser) { alert('Please login first.'); return; }
        const storeDocRef = doc(db, 'artifacts', __app_id, 'users', currentUser.uid, 'settings', 'store');
        await setDoc(storeDocRef, {
            name: storeNameInput.value,
            logo: logoInput.value
        });
        alert('Store settings saved! Refresh user.html to see changes.');
        loadStoreSettings(); // Update header logo instantly
    });

    function setupRealtimeListeners() {
        if (!currentUser) return;
        const q = collection(db, 'artifacts', __app_id, 'users', currentUser.uid, 'products');
        onSnapshot(q, (querySnapshot) => {
            const products = [];
            querySnapshot.forEach(doc => {
                products.push({ id: doc.id, ...doc.data() });
            });
            renderProducts(products);
        }, (error) => console.error("Error reading products:", error));
    }

    async function onSaveProduct(event) {
        event.preventDefault();
        if (!currentUser) { alert('Please login first.'); return; }
        
        const productData = {
            title: pTitle.value,
            description: pDesc.value,
            price: Number(pPrice.value),
            offer: pOffer.value,
            razor: pRazor.value,
            image: pImage.value,
            createdAt: serverTimestamp()
        };

        try {
            if (editDocId.value) {
                const productDocRef = doc(db, 'artifacts', __app_id, 'users', currentUser.uid, 'products', editDocId.value);
                await setDoc(productDocRef, productData);
                alert('Product updated successfully!');
            } else {
                const productColRef = collection(db, 'artifacts', __app_id, 'users', currentUser.uid, 'products');
                await addDoc(productColRef, productData);
                alert('Product added successfully!');
            }
            resetForm();
        } catch (e) {
            console.error("Save failed:", e);
            alert("Product save failed. Check console for errors.");
        }
    }

    function renderProducts(products) {
        productList.innerHTML = '';
        if (products.length === 0) {
            productList.innerHTML = '<div class="note" style="text-align:center;">Koi product nahi hai. Add karein.</div>';
            return;
        }
        products.forEach(p => {
            const div = document.createElement('div');
            div.className = 'pitem';
            div.innerHTML = `
                <div class="pthumb"><img src="${p.image||'https://placehold.co/400x200/2a2a3e/a0a0b0?text=No+Image'}" alt="${p.title}" onerror="this.onerror=null; this.src='https://placehold.co/400x200/2a2a3e/a0a0b0?text=No+Image'"></div>
                <div class="ptitle">${p.title || 'Untitled'}</div>
                <div style="color:var(--muted);font-size:13px">${(p.description||'').slice(0,80)}${(p.description||'').length>80?'...':''}</div>
                <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
                    <div>
                        <div class="price">₹ ${Number(p.price||0).toLocaleString()}</div>
                        <div class="offer">${p.offer||''}</div>
                    </div>
                    <div style="text-align:right">
                        <div style="font-size:12px;color:var(--muted)">Razorpay</div>
                        <div style="font-size:12px;max-width:120px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:var(--muted)">${p.razor||''}</div>
                    </div>
                </div>
                <div class="actions">
                    <button class="small ghost" onclick="populateForm('${p.id}')">Edit</button>
                    <button class="small" onclick="deleteProduct('${p.id}')" style="background:linear-gradient(90deg,#ff4d6d,#ff7f9a);color:white">Delete</button>
                </div>
            `;
            productList.appendChild(div);
        });
    }

    window.populateForm = async (docId) => {
        if (!currentUser) return;
        const productDocRef = doc(db, 'artifacts', __app_id, 'users', currentUser.uid, 'products', docId);
        const productDoc = await getDoc(productDocRef);
        if (productDoc.exists()) {
            const p = productDoc.data();
            editDocId.value = docId;
            pTitle.value = p.title || '';
            pDesc.value = p.description || '';
            pPrice.value = p.price || '';
            pOffer.value = p.offer || '';
            pRazor.value = p.razor || '';
            pImage.value = p.image || '';
            window.scrollTo({top:0,behavior:'smooth'});
        }
    };

    window.deleteProduct = async (docId) => {
        if (!currentUser) return;
        if(confirm('Delete this product?')){
            try {
                const productDocRef = doc(db, 'artifacts', __app_id, 'users', currentUser.uid, 'products', docId);
                await deleteDoc(productDocRef);
                alert('Product deleted!');
            } catch(e) {
                 console.error("Delete failed:", e);
                 alert('Delete failed. Check console.');
            }
        }
    };

    function resetForm(){
        editDocId.value = '';
        pTitle.value = '';
        pDesc.value = '';
        pPrice.value = '';
        pOffer.value = '';
        pRazor.value = '';
        pImage.value = '';
    }
    
    saveBtn.addEventListener('click', onSaveProduct);
    resetFormBtn.addEventListener('click', resetForm);
  </script>
</body>
</html>

